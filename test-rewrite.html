<!DOCTYPE html>
<html>
<head>
    <title>DubFusion Rewrite Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 8px; }
        .caption-simulator { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        button { margin: 5px; padding: 8px 12px; border-radius: 4px; cursor: pointer; }
        .debug-output { background: #000; color: #fff; padding: 10px; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>DubFusion Rewrite Test</h1>
    
    <div class="test-section">
        <h3>Test Instructions:</h3>
        <ol>
            <li>Load this extension in Chrome with developer mode</li>
            <li>Navigate to this test page</li>
            <li>Click "▶ Captions" to start caption sniffing</li>
            <li>Click "✍ Rewrite (stub)" to enable rewrite</li>
            <li>Use the caption simulator below to test the flow</li>
        </ol>
    </div>

    <div class="test-section">
        <h3>Caption Simulator:</h3>
        <div class="caption-simulator">
            <input type="text" id="captionInput" placeholder="Enter caption text" style="width: 300px; padding: 5px;">
            <button onclick="simulateCaption()">Simulate Caption</button>
            <button onclick="clearCaptions()">Clear Captions</button>
        </div>
    </div>

    <div class="test-section">
        <h3>Expected Behavior:</h3>
        <ul>
            <li>When captions are ON and rewrite is ON: You should see both RAW and RW sections in the debug overlay</li>
            <li>When captions are OFF and rewrite is ON: You should see "Rewrite: waiting for captions…"</li>
            <li>RW lines should be prefixed with "[Hinglish TBD]"</li>
            <li>Only the last 5 lines should be shown in each section</li>
        </ul>
    </div>

    <script>
        let currentTime = 0;
        
        function simulateCaption() {
            const text = document.getElementById('captionInput').value;
            if (!text) return;
            
            // Create a caption segment element
            const segment = document.createElement('div');
            segment.className = 'ytp-caption-segment';
            segment.textContent = text;
            
            // Create caption window container if it doesn't exist
            let container = document.querySelector('.ytp-caption-window-container');
            if (!container) {
                container = document.createElement('div');
                container.className = 'ytp-caption-window-container';
                document.body.appendChild(container);
            }
            
            // Clear previous captions and add new one
            container.innerHTML = '';
            container.appendChild(segment);
            
            // Simulate video time progression
            currentTime += 2;
            
            // Clear the input
            document.getElementById('captionInput').value = '';
        }
        
        function clearCaptions() {
            const container = document.querySelector('.ytp-caption-window-container');
            if (container) {
                container.innerHTML = '';
            }
        }
        
        // Auto-simulate some captions for testing
        setTimeout(() => {
            console.log('DubFusion: Test page loaded, ready for testing');
        }, 1000);
    </script>
</body>
</html>
