<!DOCTYPE html>
<html>
<head>
    <title>DubFusion Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-info { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .status { font-weight: bold; color: #007bff; }
        .error { color: #dc3545; }
        .success { color: #28a745; }
    </style>
</head>
<body>
    <h1>DubFusion Debug Test</h1>
    
    <div class="debug-info">
        <h3>Extension Status:</h3>
        <div id="extensionStatus" class="status">Checking...</div>
        <div id="uiStatus" class="status">Checking UI...</div>
        <div id="consoleOutput" style="background: #000; color: #fff; padding: 10px; font-family: monospace; margin-top: 10px; max-height: 200px; overflow-y: auto;"></div>
    </div>

    <div class="debug-info">
        <h3>Test Instructions:</h3>
        <ol>
            <li>Make sure the DubFusion extension is loaded in Chrome</li>
            <li>Refresh this page</li>
            <li>Check the console for DubFusion logs</li>
            <li>Look for the DubFusion UI buttons on the page</li>
        </ol>
    </div>

    <div class="debug-info">
        <h3>Manual Check:</h3>
        <button onclick="checkExtension()">Check Extension Status</button>
        <button onclick="forceUI()">Force UI Injection</button>
        <button onclick="clearConsole()">Clear Console Output</button>
    </div>

    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        const consoleOutput = document.getElementById('consoleOutput');
        
        function addToConsole(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `[${timestamp}] ${type}: ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole('LOG', args.join(' '));
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole('WARN', args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole('ERROR', args.join(' '));
        };

        function checkExtension() {
            const status = document.getElementById('extensionStatus');
            const uiStatus = document.getElementById('uiStatus');
            
            // Check if DubFusion elements exist
            const dubfusionHello = document.getElementById('dubfusion-hello');
            const dubfusionCaptions = document.getElementById('dubfusion-captions');
            const dubfusionRewrite = document.getElementById('dubfusion-rewrite');
            
            if (dubfusionHello || dubfusionCaptions || dubfusionRewrite) {
                status.innerHTML = '<span class="success">✅ DubFusion UI detected!</span>';
                uiStatus.innerHTML = '<span class="success">✅ UI elements found</span>';
            } else {
                status.innerHTML = '<span class="error">❌ DubFusion UI not found</span>';
                uiStatus.innerHTML = '<span class="error">❌ No UI elements detected</span>';
            }
        }
        
        function forceUI() {
            console.log('Manual UI injection requested');
            // Try to trigger the content script
            if (window.location.href.includes('file://')) {
                console.log('On file:// protocol, extension might not load');
            }
        }
        
        function clearConsole() {
            consoleOutput.innerHTML = '';
        }
        
        // Auto-check after page load
        setTimeout(() => {
            console.log('Debug test page loaded');
            checkExtension();
        }, 2000);
        
        // Check again after a longer delay
        setTimeout(() => {
            console.log('Delayed extension check');
            checkExtension();
        }, 5000);
    </script>
</body>
</html>
